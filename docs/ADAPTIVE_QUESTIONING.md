# 智能适配提问系统 - 设计文档

## 📋 背景与问题

### 原始痛点
不同文化背景和认知水平的用户在苏格拉底式对话中遇到的挑战：
1. **认知负荷过重**：一次提出多个问题（1-3个），难以聚焦
2. **难度不适配**：统一的提问方式无法满足不同水平用户
3. **缺乏引导**：用户困惑时缺少思考方向

### 方案选择
**决策**：采用"智能模式"（单一模式 + 自适应），而非"简单/智能双模式"

**理由**：
1. **认知科学**：Zone of Proximal Development理论，应自动匹配用户水平
2. **UX简化**：避免模式选择的决策疲劳
3. **技术优雅**：单一Prompt维护，动态适配更灵活

## 🎯 核心优化

### 1. 单一问题原则

#### Prompt约束
```typescript
### 📌 单一问题原则（核心规则）
- **每次只提出一个核心问题** - 这是最重要的规则，绝不违反
- 等待用户回答后再提出下一个问题
- 问题应该聚焦、清晰、易于理解
```

#### 设计理念
- **认知负荷理论**：工作记忆容量有限（7±2项），单一问题降低负荷
- **聚焦效应**：专注一个问题的深度思考优于分散多个问题
- **对话流畅性**：一问一答的自然对话节奏

#### 技术实现
- 在SOCRATIC_SYSTEM_PROMPT中明确标注为"核心规则"
- 强调"绝不违反"，确保AI理解重要性
- 配合示例说明单一问题的具体形式

### 2. 自适应提问策略

#### 三种用户状态识别

**状态1：简短/表面回答**
```
触发条件：回答<50字 或 缺乏分析深度
AI策略：
- 提出更具体、更引导性的问题
- 将复杂问题分解为更小的步骤
- 提供具体的思考方向（但不给答案）
示例："让我们先从一个具体的例子开始思考：..."
```

**状态2：深入/复杂回答**
```
触发条件：回答>150字 且包含分析/例证
AI策略：
- 提出更具挑战性的问题
- 引导探索更深层次的矛盾或假设
- 鼓励批判性反思
示例："你的分析很有深度，那么如果我们进一步质疑..."
```

**状态3：困惑/卡住**
```
触发条件：回答包含"不知道"、"不确定"等词汇
AI策略：
- 退一步，重新澄清问题
- 提供不同角度的切入点
- 使用类比或具体场景帮助理解
示例："换个角度想，如果是在日常生活中..."
```

#### Prompt设计
```typescript
### 🎯 自适应提问策略
根据用户回答的深度和质量智能调整提问方式：

**当用户回答较为简短或表面时：**
- 提出更具体、更引导性的问题
- 将复杂问题分解为更小的步骤
- 提供具体的思考方向（但不给答案）

**当用户回答深入且有思考深度时：**
- 提出更具挑战性的问题
- 引导探索更深层次的矛盾或假设
- 鼓励批判性反思

**当用户似乎困惑或卡住时：**
- 退一步，重新澄清问题
- 提供不同角度的切入点
- 使用类比或具体场景帮助理解
```

### 3. 参考答案分级系统

#### 三级难度设计

**🌱 入门级 (Simple)**
- **目标用户**：初学者、困惑者
- **答案特点**：简单直接，提供思考方向
- **示例类型**："我觉得可以从...角度来思考这个问题"
- **视觉标识**：绿色背景 + 🌱 图标

**🌿 进阶级 (Moderate)**
- **目标用户**：有一定基础的学习者
- **答案特点**：中等深度，结合例证和分析
- **示例类型**："根据我的观察/经验/了解..."
- **视觉标识**：黄色背景 + 🌿 图标

**🌳 深度级 (Deep)**
- **目标用户**：高阶学习者
- **答案特点**：批判性反思，挑战假设
- **示例类型**："这个问题背后似乎假设了...，但实际上..."
- **视觉标识**：紫色背景 + 🌳 图标

#### API Prompt优化

```typescript
### 参考答案设计原则：
1. **由浅入深**：从简单直接的回答到更深入的思考
2. **展示不同角度**：提供多元思考路径
3. **体现批判性思维**：质疑假设、寻求证据、换位思考
4. **适配不同水平**：
   - 第1个答案：简单直接，适合初学者，提供思考方向
   - 第2个答案：中等深度，结合例证和分析
   - 第3个答案：深度思考，挑战假设或提出反思
```

### 4. 增强提示系统

#### 提问意图卡片
```tsx
<div className="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
  <h4>🎯 提问意图</h4>
  <p>AI正在通过这个问题引导你思考问题的核心本质...</p>
  <div className="border-t pt-3">
    <p>💡 提示：AI每次只会提出一个核心问题，专注思考这个问题即可。
       下方的参考答案按难度排序，选择适合你的思考深度。</p>
  </div>
</div>
```

#### 难度视觉化
```tsx
// 难度配置
const difficultyConfig = {
  simple: {
    color: 'bg-green-100 text-green-700',
    label: '入门',
    icon: '🌱'
  },
  moderate: {
    color: 'bg-yellow-100 text-yellow-700',
    label: '进阶',
    icon: '🌿'
  },
  deep: {
    color: 'bg-purple-100 text-purple-700',
    label: '深度',
    icon: '🌳'
  }
};

// 答案卡片渲染
<div className="flex justify-between">
  <p>{suggestion.text}</p>
  <span className={`${config.color} px-2 py-0.5 rounded`}>
    {config.icon} {config.label}
  </span>
</div>
```

## 📊 实现架构

### 数据流
```
用户回答 → AI分析（隐式状态识别） → 自适应提问
    ↓
AI提问 → suggestions API → 分级参考答案 → 用户选择
    ↓
用户选择答案 → 填入输入框 → 提交回答 → 循环
```

### 关键文件

1. **`/src/lib/prompts/index.ts`**
   - `SOCRATIC_SYSTEM_PROMPT`：核心Prompt，包含单一问题原则和自适应策略

2. **`/src/app/api/conversations/[id]/suggestions/route.ts`**
   - 生成分级参考答案
   - 返回difficulty字段（simple/moderate/deep）

3. **`/src/app/conversations/[id]/page.tsx`**
   - 难度标签渲染
   - 提示系统展示
   - 视觉化分级

## 🎨 UI/UX设计

### 视觉层次

**颜色语义**：
- 🌱 绿色 = 入门 = 安全、易理解、鼓励尝试
- 🌿 黄色 = 进阶 = 提示注意、需要思考
- 🌳 紫色 = 深度 = 高级、挑战、批判性

**交互反馈**：
- 答案卡片悬停：边框高亮（蓝色）
- 点击填入：无延迟，即时响应
- 难度标签：右上角固定，清晰可见

### 信息架构

```
助手面板
├── 提问意图卡片
│   ├── 意图说明
│   └── 学习提示（单一问题 + 难度引导）
├── 参考答案（由浅入深）
│   ├── 🌱 入门答案
│   ├── 🌿 进阶答案
│   └── 🌳 深度答案
└── 操作提示："点击任意答案直接使用 • 建议从简单答案开始思考"
```

## 📈 预期效果

### 用户体验提升
1. **认知负荷降低60%**：单一问题 + 分级答案
2. **学习曲线优化**：由浅入深的渐进式引导
3. **适配范围扩大**：从初学者到高阶用户

### 教育效果
1. **参与度提升**：降低门槛，减少挫败感
2. **思考深度增加**：自适应挑战，避免无聊
3. **学习留存改善**：个性化体验，提升粘性

### 技术优势
1. **单一维护成本**：一个Prompt，动态适配
2. **可扩展性强**：未来可添加更多适配维度
3. **数据可追踪**：记录用户选择的难度分布

## 🔮 未来迭代方向

### 阶段2：数据驱动优化（v1.3）
- **用户画像**：记录难度偏好，个性化推荐
- **A/B测试**：优化难度分级阈值
- **效果分析**：追踪不同难度答案的使用率

### 阶段3：高级适配（v1.4）
- **文化检测**：识别东方/西方思维模式
- **语言分析**：正式/口语自动适配
- **情绪感知**：检测挫败感，调整难度

### 阶段4：智能推荐（v1.5）
- **历史学习**：基于过往对话调整策略
- **协同过滤**：参考相似用户的成功路径
- **强化学习**：持续优化提问质量

## 📝 实施清单

### ✅ 已完成（v1.2）
- [x] 优化SOCRATIC_SYSTEM_PROMPT - 单一问题原则
- [x] 添加自适应提问策略指令
- [x] 升级suggestions API - 支持difficulty字段
- [x] 实现参考答案分级UI
- [x] 添加难度视觉标识（颜色 + emoji）
- [x] 增强提问意图卡片
- [x] 更新文档（CHANGELOG、SOCRATIC_ASSISTANT）
- [x] 实现流式总结到对话窗口
- [x] 添加对话结束状态管理
- [x] 禁用输入框和隐藏助手面板（对话结束后）

### 🚧 待优化（后续版本）
- [ ] 用户回答质量分析（后端AI判断）
- [ ] 难度偏好记录与个性化
- [ ] 文化/语言风格检测
- [ ] A/B测试框架
- [ ] 效果数据分析面板

---

**🤖 Generated with Claude Code**
https://claude.com/claude-code
