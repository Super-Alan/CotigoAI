# 话题生成功能测试指南

## ✅ 完成的更新

### 1. 创建了 5 大类专业提示词文件
- `src/prompts/topic-generation/causal-analysis.ts` - 多维归因与利弊权衡
- `src/prompts/topic-generation/premise-challenge.ts` - 前提质疑与方法批判
- `src/prompts/topic-generation/fallacy-detection.ts` - 逻辑谬误识别与证据评估
- `src/prompts/topic-generation/iterative-reflection.ts` - 自我认知与观点迭代
- `src/prompts/topic-generation/connection-transfer.ts` - 跨领域关联与迁移

每个提示词文件包含：
- 详细的角色设定和核心使命
- 3个难度级别的详细设计标准
- 完整的话题结构设计规范
- 质量保障标准和检查清单
- 不同难度的完整示例

### 2. 更新了话题生成器 (`src/lib/topicGenerator.ts`)
- `buildSystemPrompt()` 函数现在根据维度选择对应的专业提示词
- `buildUserPrompt()` 函数优化，适配新的提示词格式
- `generateTopicsWithLLM()` 函数增加了详细日志和错误处理
- 支持单个对象和数组两种返回格式

### 3. 更新了 API 路由 (`src/app/api/topics/generate/route.ts`)
- 传递维度参数给 `buildSystemPrompt()`
- 启用专业提示词系统

### 4. 优化了前端对话页面 (`src/app/conversations/page.tsx`)
- 添加了专业提示词系统启用的提示信息
- 优化了话题卡片的详情展示
- 新增：常见思维误区展示
- 新增：学习成果展示
- 改进：引导问题的展示格式

### 5. 数据库迁移
- 运行了 `prisma generate` 生成新的客户端
- 运行了 `prisma db push` 同步数据库 schema

## 🧪 测试步骤

### 1. 启动开发服务器
\`\`\`bash
npm run dev
\`\`\`

### 2. 访问对话页面
打开浏览器访问: http://localhost:3000/conversations

### 3. 测试话题生成功能

#### 测试场景 1：多维归因与利弊权衡
1. 点击「✨ 定制生成」Tab
2. 选择维度：🔍 多维归因与利弊权衡
3. 选择难度：进阶级
4. 点击「✨ 生成专属话题推荐」
5. 等待 5-10 秒
6. 自动切换到「📚 话题广场」，查看生成的话题

**预期结果：**
- 生成的话题应该聚焦现实议题
- 包含多个维度的分析（经济、社会、伦理等）
- 引导问题层层递进
- 包含常见思维误区和学习成果

#### 测试场景 2：前提质疑与方法批判
1. 选择维度：❓ 前提质疑与方法批判
2. 选择难度：高级
3. 点击生成

**预期结果：**
- 话题基于学术研究或理论
- 包含前提假设识别
- 包含方法论批判
- 引导问题包括改进与验证方案

#### 测试场景 3：逻辑谬误识别
1. 选择维度：⚖️ 谬误识别与证据评估
2. 选择难度：入门级
3. 点击生成

**预期结果：**
- 话题基于现实论证场景
- 包含明显的逻辑谬误
- 引导问题帮助识别谬误类型
- 包含证据验证方案

#### 测试场景 4：观点迭代与反思
1. 选择维度：🔄 观点迭代与反思
2. 选择难度：进阶级
3. 点击生成

**预期结果：**
- 话题包含过往观点和新信息
- 引导学生进行自我反思
- 包含认知盲区识别
- 体现成长型思维

#### 测试场景 5：跨领域迁移
1. 选择维度：🔗 关联与迁移
2. 选择难度：高级
3. 点击生成

**预期结果：**
- 话题涉及两个不同领域
- 包含类比推理
- 引导问题包括核心逻辑提炼和迁移方案设计
- 识别适配性和局限性

### 4. 测试话题卡片功能
1. 点击「查看引导问题框架 →」展开详情
2. 查看：
   - ⚠️ 常见思维误区（红色背景）
   - 💬 引导问题（3个阶段）
   - 🎯 学习成果（绿色背景）
3. 点击「开始训练 →」按钮
4. 应该跳转到苏格拉底对话页面，并自动开始对话

## 🔍 验证要点

### 提示词质量
- [ ] 生成的话题是否符合选定的维度特征
- [ ] 难度设置是否准确（入门/进阶/高级）
- [ ] 话题是否基于现实场景或真实案例
- [ ] 引导问题是否层层递进

### 数据完整性
- [ ] 话题是否包含所有必需字段
- [ ] thinkingFramework 是否包含 3 个常见误区
- [ ] guidingQuestions 是否包含 3 个层级
- [ ] expectedOutcomes 是否包含 4-5 个学习成果

### 用户体验
- [ ] 生成过程是否有加载提示
- [ ] 生成失败是否有错误提示
- [ ] 话题卡片展示是否清晰
- [ ] 深色模式是否正常显示

## 📊 性能指标

- **生成时间**：5-15 秒（取决于 API 响应速度）
- **Token 消耗**：每个话题约 3000-8000 tokens
- **数据库保存**：每个话题约 2-5 KB

## 🐛 常见问题

### 1. 生成失败
- 检查 `.env` 文件中的 API Key 是否配置正确
- 查看控制台日志，确认 API 调用是否成功
- 确认数据库连接正常

### 2. 格式错误
- 查看 LLM 返回的原始 JSON
- 检查是否包含 markdown 标记
- 验证 JSON 结构是否符合 schema

### 3. 页面显示异常
- 检查浏览器控制台是否有 JavaScript 错误
- 确认 Prisma Client 已重新生成
- 刷新页面重试

## 📝 下一步优化建议

1. **批量生成优化**：支持一次生成多个不同维度的话题
2. **个性化推荐**：根据用户历史对话记录推荐合适难度的话题
3. **话题收藏**：允许用户收藏喜欢的话题
4. **话题评分**：用户完成对话后可以对话题质量进行评分
5. **A/B 测试**：对比新旧提示词系统的生成质量
