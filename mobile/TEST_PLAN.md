# CotigoAI 移动端功能测试计划

## 测试环境
- **测试账号**: Alan810@qq.com / 357159
- **测试设备**: iOS/Android模拟器或真机
- **API服务**: http://localhost:3011 (或生产环境)

## 测试范围
1. 对话功能 (Conversations)
2. 解构功能 (Arguments)
3. 多视角功能 (Perspectives)
4. 历史记录查询

---

## 一、对话功能测试 (Conversations)

### 1.1 创建新对话并自动开始

**测试步骤**:
1. 登录APP (Alan810@qq.com / 357159)
2. 进入"对话" Tab
3. 在"开始新对话"输入框输入话题: "我认为人工智能最终会取代所有人类工作"
4. 点击"开始对话"按钮

**预期结果**:
- ✅ 成功创建对话并跳转到详情页
- ✅ 自动发送初始消息: "我想和你探讨这个话题: 我认为人工智能最终会取代所有人类工作"
- ✅ AI开始流式返回第一个苏格拉底式问题
- ✅ 流式响应过程中可以看到AI回复逐字显示
- ✅ 回复完成后,消息保存到对话历史

**测试数据**:
```
输入话题: "我认为人工智能最终会取代所有人类工作"
预期AI响应: 苏格拉底式提问(如:"你是如何定义'所有人类工作'的?")
```

### 1.2 智能助手自动生成建议答案

**测试步骤**:
1. 继续上一步的对话
2. 等待AI回复完成
3. 观察智能助手浮动按钮(右下角💡图标)

**预期结果**:
- ✅ AI回复完成后,自动生成建议答案
- ✅ 浮动按钮显示红色数字角标(显示建议数量,通常2-3个)
- ✅ 点击浮动按钮,打开智能助手抽屉
- ✅ 显示2-3个不同难度的建议答案:
  - 🌱 入门 (绿色)
  - 🌿 进阶 (黄色)
  - 🌳 深度 (紫色)
- ✅ 每个建议显示答案内容和意图说明(💡 ...)

**测试数据**:
```
建议答案数量: 2-3个
难度标签: simple/moderate/deep
必须包含: text内容 + intent意图说明
```

### 1.3 使用建议答案并继续对话

**测试步骤**:
1. 在智能助手抽屉中点击任一建议答案
2. 观察输入框
3. 修改或直接发送

**预期结果**:
- ✅ 建议答案内容填充到输入框
- ✅ 智能助手抽屉自动关闭
- ✅ 可以编辑答案内容
- ✅ 点击发送按钮,消息正常发送
- ✅ AI开始新一轮流式响应
- ✅ 新一轮完成后,再次自动生成建议答案

### 1.4 历史对话查看

**测试步骤**:
1. 返回对话列表页
2. 查看"最近对话"区域
3. 点击刚才创建的对话

**预期结果**:
- ✅ 对话列表显示最近的3条对话
- ✅ 显示对话标题和话题
- ✅ 显示创建日期
- ✅ 点击进入详情页
- ✅ 完整显示所有历史消息(用户消息和AI回复)
- ✅ 消息时间戳正确显示
- ✅ 流式响应状态正确(不再显示加载中)

### 1.5 对话总结生成

**测试步骤**:
1. 继续对话直到消息数≥5条
2. 打开智能助手
3. 点击"生成思维总结"按钮

**预期结果**:
- ✅ 按钮在消息数≥5时显示
- ✅ 点击后显示"生成中..."
- ✅ 成功生成总结内容
- ✅ 总结包含关键洞察和思维进展

---

## 二、解构功能测试 (Arguments)

### 2.1 创建新论证分析

**测试步骤**:
1. 进入"解构" Tab
2. 在输入框输入论证文本:
   ```
   大学教育应该免费。因为教育是基本人权,
   而且许多发达国家已经实行免费大学教育。
   统计数据显示,免费大学教育可以提高社会流动性。
   ```
3. 点击"开始分析"按钮

**预期结果**:
- ✅ 开始流式分析(显示"AI 正在分析...")
- ✅ 逐步显示分析结果
- ✅ 分析完成后跳转到详情页
- ✅ 详情页显示完整分析结果:
  - 主要主张
  - 论证强度(评分进度条)
  - 前提列表
  - 证据展示
  - 假设分析
  - 逻辑结构
  - 潜在谬误(带严重程度标签)

### 2.2 查看论证分析详情

**测试步骤**:
1. 在分析详情页滚动查看各项内容
2. 检查每个部分的数据展示

**预期结果**:
- ✅ 主张清晰显示
- ✅ 论证强度以进度条+评分显示(X/10)
- ✅ 进度条颜色根据强度变化(绿/蓝/橙)
- ✅ 前提、证据、假设以列表形式展示
- ✅ 谬误显示严重程度标签(严重/较重/轻微)
- ✅ 所有卡片样式一致,阴影和圆角正确

### 2.3 历史分析记录查询

**测试步骤**:
1. 返回解构列表页
2. 查看"分析历史"
3. 点击任一历史记录

**预期结果**:
- ✅ 显示最近的分析记录
- ✅ 每条记录显示输入文本摘要和创建时间
- ✅ 点击进入详情页
- ✅ 详情页正确加载历史分析结果

---

## 三、多视角功能测试 (Perspectives)

### 3.1 创建多视角分析会话

**测试步骤**:
1. 进入"视角" Tab
2. 在输入框输入话题: "人工智能对就业市场的影响"
3. 点击"生成视角"按钮

**预期结果**:
- ✅ 显示角色选择(如果有)或直接开始生成
- ✅ 开始流式生成多个视角
- ✅ 生成3-5个不同角色的视角
- ✅ 每个视角显示角色名称和图标
- ✅ 生成完成后跳转到详情页

### 3.2 自动生成视角

**测试步骤**:
1. 创建会话后进入详情页
2. 如果会话没有视角,观察是否自动生成

**预期结果**:
- ✅ 如果会话无视角,自动调用生成API
- ✅ 显示生成中状态
- ✅ 生成完成后显示所有视角

### 3.3 视角切换和查看

**测试步骤**:
1. 在视角详情页查看所有视角
2. 点击不同视角

**预期结果**:
- ✅ 显示所有生成的视角列表
- ✅ 每个视角显示角色图标、名称和观点摘要
- ✅ 点击视角可以切换查看
- ✅ 当前选中视角高亮显示

### 3.4 与视角对话

**测试步骤**:
1. 选择一个视角
2. 在输入框输入问题: "你的观点有哪些证据支持?"
3. 点击发送

**预期结果**:
- ✅ 消息发送成功
- ✅ 该视角开始回复(基于其角色立场)
- ✅ 回复内容与该视角的观点一致
- ✅ 可以继续追问和对话

### 3.5 视角综合

**测试步骤**:
1. 完成与多个视角的对话
2. 点击"综合视角"按钮

**预期结果**:
- ✅ 显示"综合中..."状态
- ✅ 成功生成综合分析
- ✅ 综合内容包含:
  - 各视角的核心观点总结
  - 观点之间的共识和分歧
  - 综合性建议
- ✅ 弹出成功提示

### 3.6 历史会话查询

**测试步骤**:
1. 返回视角列表页
2. 查看"历史会话"
3. 点击任一会话

**预期结果**:
- ✅ 显示历史会话列表
- ✅ 显示会话话题和创建时间
- ✅ 点击进入详情页
- ✅ 正确加载所有视角和对话历史

---

## 四、历史记录查询功能测试

### 4.1 对话历史记录

**测试步骤**:
1. 进入对话列表页
2. 查看"最近对话"区域
3. 点击"查看全部"(如有)

**预期结果**:
- ✅ 显示所有历史对话(按时间倒序)
- ✅ 每条记录显示:
  - 对话标题
  - 话题内容
  - 创建日期
- ✅ 可以正常进入任一对话查看详情
- ✅ 支持下拉刷新

### 4.2 解构历史记录

**测试步骤**:
1. 进入解构列表页
2. 查看"分析历史"
3. 滚动加载更多(如果有)

**预期结果**:
- ✅ 显示所有历史分析
- ✅ 显示输入文本摘要和时间
- ✅ 可以正常查看详情
- ✅ 支持下拉刷新

### 4.3 视角历史记录

**测试步骤**:
1. 进入视角列表页
2. 查看"历史会话"
3. 检查所有会话

**预期结果**:
- ✅ 显示所有历史会话
- ✅ 显示话题和创建时间
- ✅ 可以正常查看详情
- ✅ 支持下拉刷新

---

## 五、通用功能测试

### 5.1 认证和授权

**测试步骤**:
1. 退出登录
2. 使用测试账号重新登录
3. 访问各个功能

**预期结果**:
- ✅ JWT Token正确存储在SecureStore
- ✅ 所有API请求自动携带Token
- ✅ Token过期时自动刷新或提示重新登录

### 5.2 错误处理

**测试步骤**:
1. 关闭网络连接
2. 尝试创建对话/分析/视角
3. 恢复网络

**预期结果**:
- ✅ 网络错误时显示友好提示
- ✅ 不会导致应用崩溃
- ✅ 恢复网络后可以重试

### 5.3 加载状态

**测试步骤**:
1. 观察各功能的加载状态
2. 检查所有loading指示器

**预期结果**:
- ✅ 列表加载时显示ActivityIndicator
- ✅ 按钮loading时显示"创建中..."/"生成中..."
- ✅ 流式响应时显示"AI 正在思考..."
- ✅ 所有loading状态都有明确提示

---

## 测试检查清单

### 对话功能 (8项)
- [ ] 创建新对话并自动开始
- [ ] 流式AI响应正常显示
- [ ] 自动生成建议答案
- [ ] 建议答案格式正确(难度+图标+意图)
- [ ] 使用建议答案功能正常
- [ ] 查看历史对话完整
- [ ] 生成对话总结
- [ ] 智能助手交互流畅

### 解构功能 (4项)
- [ ] 创建论证分析
- [ ] 流式分析正常
- [ ] 分析详情完整显示
- [ ] 查看历史分析记录

### 多视角功能 (6项)
- [ ] 创建多视角会话
- [ ] 自动生成视角
- [ ] 视角切换功能
- [ ] 与视角对话
- [ ] 视角综合
- [ ] 查看历史会话

### 历史记录 (3项)
- [ ] 对话历史查询
- [ ] 解构历史查询
- [ ] 视角历史查询

### 通用功能 (3项)
- [ ] 认证授权正常
- [ ] 错误处理友好
- [ ] 加载状态清晰

**总计: 24项测试**

---

## 测试报告模板

```markdown
## 测试执行记录

**测试时间**: YYYY-MM-DD HH:MM
**测试人员**: [Name]
**测试账号**: Alan810@qq.com
**测试设备**: [iOS 17.0 / Android 13]

### 测试结果汇总
- ✅ 通过: XX/24
- ❌ 失败: XX/24
- ⚠️ 部分通过: XX/24

### 详细测试结果

#### 对话功能
- [x] ✅ 创建新对话并自动开始
- [x] ✅ 流式AI响应正常
- [ ] ❌ 建议答案未自动生成 - 需手动打开助手
  - **问题描述**: ...
  - **复现步骤**: ...
  - **错误信息**: ...

[继续记录其他测试项...]

### 发现的问题

1. **[严重] 建议答案未自动生成**
   - 位置: conversations/[id].tsx:52-70
   - 预期: AI回复完成后自动生成
   - 实际: 需手动打开智能助手才触发
   - 修复建议: 添加useEffect监听AI回复完成

2. **[中等] 历史消息时间格式错误**
   - 位置: MessageBubble.tsx:43
   - 预期: 显示正确时间
   - 实际: 显示 "Invalid Date"
   - 修复建议: 使用createdAt字段

### 测试覆盖率

- 对话功能: 100% (8/8)
- 解构功能: 100% (4/4)
- 视角功能: 100% (6/6)
- 历史记录: 100% (3/3)
- 通用功能: 100% (3/3)

**总覆盖率: 100% (24/24)**
```

---

## 自动化测试建议

由于当前项目未配置测试框架,建议添加:

1. **Jest + React Native Testing Library**
   ```bash
   npm install --save-dev jest @testing-library/react-native @testing-library/jest-native
   ```

2. **E2E测试 (Detox)**
   ```bash
   npm install --save-dev detox
   ```

3. **API模拟 (MSW)**
   ```bash
   npm install --save-dev msw
   ```

### 单元测试示例

```typescript
// __tests__/hooks/useConversations.test.ts
import { renderHook, waitFor } from '@testing-library/react-native';
import { useConversations } from '@/src/hooks/useConversations';

describe('useConversations', () => {
  it('should fetch conversations list', async () => {
    const { result } = renderHook(() => useConversations());

    await waitFor(() => {
      expect(result.current.data).toBeDefined();
      expect(result.current.isLoading).toBe(false);
    });
  });
});
```

### E2E测试示例

```typescript
// e2e/conversations.e2e.ts
describe('Conversations Flow', () => {
  beforeAll(async () => {
    await device.launchApp();
  });

  it('should create new conversation and auto-start', async () => {
    // 登录
    await element(by.id('email-input')).typeText('Alan810@qq.com');
    await element(by.id('password-input')).typeText('357159');
    await element(by.id('login-button')).tap();

    // 创建对话
    await element(by.id('topic-input')).typeText('AI测试话题');
    await element(by.id('start-button')).tap();

    // 验证自动开始
    await waitFor(element(by.text('我想和你探讨这个话题')))
      .toBeVisible()
      .withTimeout(5000);
  });
});
```
