# ç§»åŠ¨ç«¯æ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½æµ‹è¯•æŒ‡å—

## æµ‹è¯•å‰å‡†å¤‡

1. ç¡®ä¿ Metro bundler æ­£åœ¨è¿è¡Œ
2. åœ¨ Expo Go æˆ–æ¨¡æ‹Ÿå™¨ä¸­æ‰“å¼€åº”ç”¨
3. è¿›å…¥æˆ–åˆ›å»ºä¸€ä¸ªå¯¹è¯

## åŠŸèƒ½æµ‹è¯•æ­¥éª¤

### 1. è½®æ¬¡è¿›åº¦æ˜¾ç¤ºæµ‹è¯•

**ç›®æ ‡**: éªŒè¯è½®æ¬¡è®¡æ•°å’Œè¿›åº¦æ¡æ­£ç¡®æ˜¾ç¤º

**æ­¥éª¤**:
1. å‘é€ç¬¬1æ¡ç”¨æˆ·æ¶ˆæ¯
2. ç­‰å¾…AIå›å¤
3. ç‚¹å‡»å³ä¸‹è§’çš„ ğŸ’¡ å›¾æ ‡æ‰“å¼€æ™ºèƒ½åŠ©æ‰‹æŠ½å±‰
4. **é¢„æœŸç»“æœ**:
   - çœ‹åˆ° "ğŸ’¡ æ™ºèƒ½åŠ©æ‰‹" å³ä¾§æ˜¾ç¤º "ç¬¬ 1/5 è½®"
   - è¿›åº¦æ¡å®½åº¦çº¦ä¸º 20% (è“è‰²)

5. ç»§ç»­å‘é€ç¬¬2-5æ¡æ¶ˆæ¯
6. æ¯æ¬¡AIå›å¤åæ‰“å¼€åŠ©æ‰‹
7. **é¢„æœŸç»“æœ**:
   - ç¬¬2è½®: "ç¬¬ 2/5 è½®", è¿›åº¦æ¡ 40%
   - ç¬¬3è½®: "ç¬¬ 3/5 è½®", è¿›åº¦æ¡ 60%
   - ç¬¬4è½®: "ç¬¬ 4/5 è½®", è¿›åº¦æ¡ 80%
   - ç¬¬5è½®: "ç¬¬ 5/5 è½®", è¿›åº¦æ¡ 100%

### 2. æ€»ç»“æŒ‰é’®æ–‡æ¡ˆæµ‹è¯•

**ç›®æ ‡**: éªŒè¯æŒ‰é’®æ–‡æ¡ˆæ ¹æ®è½®æ¬¡åŠ¨æ€å˜åŒ–

**æ­¥éª¤**:
1. ç¬¬1è½®æ—¶æ‰“å¼€åŠ©æ‰‹æŠ½å±‰
2. **é¢„æœŸç»“æœ**: çœ‹åˆ° "ç”Ÿæˆæ€ç»´æ€»ç»“" æŒ‰é’® (ç°è‰²æ¬¡è¦æŒ‰é’®)

3. ç¬¬5è½®æ—¶æ‰“å¼€åŠ©æ‰‹æŠ½å±‰
4. **é¢„æœŸç»“æœ**: çœ‹åˆ° "ç»“æŸå¹¶ç”Ÿæˆæ€»ç»“" æŒ‰é’® (è“è‰²ä¸»è¦æŒ‰é’®)

### 3. æ€»ç»“ç”Ÿæˆæµ‹è¯•

**ç›®æ ‡**: éªŒè¯æµå¼æ€»ç»“ç”Ÿæˆå’Œæ˜¾ç¤º

**æ­¥éª¤**:
1. åœ¨ç¬¬5è½®æˆ–ä¹‹åï¼Œç‚¹å‡» "ç»“æŸå¹¶ç”Ÿæˆæ€»ç»“" æŒ‰é’®
2. **é¢„æœŸç»“æœ**:
   - å»ºè®®ç­”æ¡ˆåˆ—è¡¨éšè—
   - æ˜¾ç¤ºç´«è‰²èƒŒæ™¯çš„æ€»ç»“åŒºåŸŸ
   - åˆå§‹æ˜¾ç¤º "ğŸ“Š æ­£åœ¨ç”Ÿæˆå¯¹è¯æ€»ç»“..."
   - æ€»ç»“å†…å®¹é€æ­¥å®æ—¶æ˜¾ç¤º (æµå¼)

3. ç­‰å¾…æ€»ç»“å®Œæˆ
4. **é¢„æœŸç»“æœ**:
   - æ€»ç»“å†…å®¹å®Œæ•´æ˜¾ç¤º
   - åº•éƒ¨å‡ºç°ä¸¤ä¸ªæŒ‰é’®:
     - å·¦ä¾§: "ç»§ç»­è¿½é—®" (è“è‰²æŒ‰é’®)
     - å³ä¾§: "å…³é—­" (ç°è‰²æŒ‰é’®)
   - "ç”Ÿæˆæ€ç»´æ€»ç»“" æŒ‰é’®éšè—

### 4. å¯¹è¯ç»“æŸçŠ¶æ€æµ‹è¯•

**ç›®æ ‡**: éªŒè¯å¯¹è¯ç»“æŸåçš„äº¤äº’é€»è¾‘

**æ­¥éª¤A - ç»§ç»­è¿½é—®**:
1. æ€»ç»“å®Œæˆåï¼Œç‚¹å‡» "ç»§ç»­è¿½é—®" æŒ‰é’®
2. **é¢„æœŸç»“æœ**:
   - åŠ©æ‰‹æŠ½å±‰å…³é—­
   - conversationEnded çŠ¶æ€é‡ç½®ä¸º false
   - å¯ä»¥ç»§ç»­å‘é€æ¶ˆæ¯
   - å†æ¬¡æ‰“å¼€åŠ©æ‰‹æ—¶ï¼Œä¸æ˜¾ç¤ºæ€»ç»“ï¼Œæ˜¾ç¤ºå»ºè®®ç­”æ¡ˆ
   - "ç”Ÿæˆæ€ç»´æ€»ç»“" æŒ‰é’®å†æ¬¡å‡ºç°

**æ­¥éª¤B - å…³é—­**:
1. æ€»ç»“å®Œæˆåï¼Œç‚¹å‡» "å…³é—­" æŒ‰é’®
2. **é¢„æœŸç»“æœ**:
   - åŠ©æ‰‹æŠ½å±‰å…³é—­
   - conversationEnded çŠ¶æ€ä¿æŒä¸º true
   - å†æ¬¡æ‰“å¼€åŠ©æ‰‹æ—¶ï¼Œä»ç„¶æ˜¾ç¤ºä¹‹å‰çš„æ€»ç»“

### 5. å»ºè®®ç­”æ¡ˆæ˜¾ç¤ºæµ‹è¯•

**ç›®æ ‡**: éªŒè¯éš¾åº¦æ ‡ç­¾å’Œæ„å›¾è¯´æ˜æ­£ç¡®æ˜¾ç¤º

**æ­¥éª¤**:
1. AIå›å¤åæ‰“å¼€åŠ©æ‰‹æŠ½å±‰
2. **é¢„æœŸç»“æœ**:
   - çœ‹åˆ°3æ¡å»ºè®®ç­”æ¡ˆ
   - æ¯æ¡éƒ½æœ‰éš¾åº¦æ ‡ç­¾:
     - ç¬¬1æ¡: ğŸŒ± å…¥é—¨ (ç»¿è‰²èƒŒæ™¯)
     - ç¬¬2æ¡: ğŸŒ¿ è¿›é˜¶ (é»„è‰²èƒŒæ™¯)
     - ç¬¬3æ¡: ğŸŒ³ æ·±åº¦ (ç´«è‰²èƒŒæ™¯)
   - æ¯æ¡å»ºè®®ä¸‹æ–¹æ˜¾ç¤º "ğŸ’¡ æé—®æ„å›¾è¯´æ˜"

3. ç‚¹å‡»ä»»ä¸€å»ºè®®ç­”æ¡ˆ
4. **é¢„æœŸç»“æœ**:
   - å»ºè®®å†…å®¹å¡«å…¥è¾“å…¥æ¡†
   - åŠ©æ‰‹æŠ½å±‰å…³é—­

## è¾¹ç•Œæƒ…å†µæµ‹è¯•

### æµ‹è¯•1: æ— æ¶ˆæ¯çŠ¶æ€
- **æ“ä½œ**: åœ¨æ–°å¯¹è¯ä¸­ï¼ˆ0æ¡æ¶ˆæ¯ï¼‰æ‰“å¼€åŠ©æ‰‹
- **é¢„æœŸ**: ä¸æ˜¾ç¤ºè½®æ¬¡è¿›åº¦ï¼Œä¸æ˜¾ç¤ºæ€»ç»“æŒ‰é’®

### æµ‹è¯•2: ç¬¬1-4è½®ä¸åº”æ˜¾ç¤ºæ€»ç»“
- **æ“ä½œ**: åœ¨ç¬¬1-4è½®æ—¶æŸ¥çœ‹åŠ©æ‰‹
- **é¢„æœŸ**: åªæ˜¾ç¤º "ç”Ÿæˆæ€ç»´æ€»ç»“" æŒ‰é’®ï¼Œä¸æ˜¯ "ç»“æŸå¹¶ç”Ÿæˆæ€»ç»“"

### æµ‹è¯•3: æ€»ç»“å¤±è´¥å¤„ç†
- **æ“ä½œ**: åœ¨ç½‘ç»œæ–­å¼€çŠ¶æ€ä¸‹ç‚¹å‡»ç”Ÿæˆæ€»ç»“
- **é¢„æœŸ**: æ˜¾ç¤º "âŒ ç”Ÿæˆæ€»ç»“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"

### æµ‹è¯•4: é‡å¤ç”Ÿæˆæ€»ç»“
- **æ“ä½œ**: å·²ç”Ÿæˆæ€»ç»“åï¼Œç‚¹å‡» "ç»§ç»­è¿½é—®"ï¼Œå†æ¬¡åˆ°ç¬¬5è½®åå†ç”Ÿæˆæ€»ç»“
- **é¢„æœŸ**: å¯ä»¥æ­£å¸¸ç”Ÿæˆæ–°çš„æ€»ç»“

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åœ¨ Metro bundler ç»ˆç«¯ä¸­æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```bash
# æŸ¥çœ‹è½®æ¬¡æ›´æ–°
[VoiceInput] Current round: 3

# æŸ¥çœ‹æ€»ç»“ç”Ÿæˆ
[Summary] Generating summary for conversation: xxx
[Summary] Summary complete

# æŸ¥çœ‹APIé”™è¯¯
[Speech] Failed to generate summary: Error message
```

### æ£€æŸ¥çŠ¶æ€å€¼

åœ¨ä»£ç ä¸­ä¸´æ—¶æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼š

```typescript
// åœ¨ useEffect ä¸­æŸ¥çœ‹è½®æ¬¡
useEffect(() => {
  console.log('Current round:', currentRound);
  console.log('Dialogue history:', dialogueHistory);
}, [currentRound, dialogueHistory]);

// åœ¨æ€»ç»“ç”Ÿæˆæ—¶æŸ¥çœ‹çŠ¶æ€
useEffect(() => {
  console.log('Summary content:', summaryContent);
  console.log('Conversation ended:', conversationEnded);
  console.log('Show summary:', showSummary);
}, [summaryContent, conversationEnded, showSummary]);
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: çœ‹ä¸åˆ°è½®æ¬¡è¿›åº¦

**å¯èƒ½åŸå› **:
- currentRound çŠ¶æ€æ²¡æœ‰æ›´æ–°
- AIå›å¤æœªæ­£ç¡®è§¦å‘ useEffect

**æ’æŸ¥æ–¹æ³•**:
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰è½®æ¬¡æ›´æ–°æ—¥å¿—
2. ç¡®è®¤ conversation.messages åŒ…å«ç”¨æˆ·æ¶ˆæ¯
3. æ£€æŸ¥ useEffect ä¾èµ–é¡¹æ˜¯å¦æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥ useEffect æ˜¯å¦è§¦å‘
useEffect(() => {
  console.log('Messages updated:', conversation?.messages?.length);
  console.log('Is sending:', isSending);
  console.log('Streaming:', streamingMessage);
}, [conversation?.messages, isSending, streamingMessage, currentRound]);
```

### é—®é¢˜2: æŒ‰é’®ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **:
- currentRound < 1
- conversationEnded ä¸º true

**æ’æŸ¥æ–¹æ³•**:
1. æ‰“å¼€ React DevTools æŸ¥çœ‹çŠ¶æ€å€¼
2. æ£€æŸ¥æ¡ä»¶åˆ¤æ–­é€»è¾‘

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// ä¸´æ—¶æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
<Text>Debug: Round={currentRound}, Ended={conversationEnded ? 'Yes' : 'No'}</Text>
```

### é—®é¢˜3: æ€»ç»“ä¸æ˜¾ç¤º

**å¯èƒ½åŸå› **:
- showSummary æˆ– summaryContent ä¸ºç©º
- APIè¿”å›æ ¼å¼ä¸æ­£ç¡®

**æ’æŸ¥æ–¹æ³•**:
1. æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸ
2. æŸ¥çœ‹APIå“åº”æ ¼å¼
3. æ£€æŸ¥æµå¼è§£æé€»è¾‘

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// åœ¨ handleGenerateSummary ä¸­æ·»åŠ æ—¥å¿—
console.log('Starting summary generation...');
console.log('Summary content:', summaryContent);
console.log('Show summary:', showSummary);
```

### é—®é¢˜4: "ç»§ç»­è¿½é—®"ä¸å·¥ä½œ

**å¯èƒ½åŸå› **:
- çŠ¶æ€é‡ç½®é€»è¾‘æœ‰è¯¯
- conversationEnded æœªæ­£ç¡®æ›´æ–°

**æ’æŸ¥æ–¹æ³•**:
1. æ£€æŸ¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ˜¯å¦è§¦å‘
2. ç¡®è®¤çŠ¶æ€æ›´æ–°å‡½æ•°è¢«è°ƒç”¨

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// åœ¨æŒ‰é’®ç‚¹å‡»å¤„ç†ä¸­æ·»åŠ æ—¥å¿—
onPress={() => {
  console.log('Continue asking clicked');
  setConversationEnded(false);
  setShowSummary(false);
  setShowAssistant(false);
  console.log('State reset complete');
}}
```

## æ€§èƒ½æµ‹è¯•

### æµå¼æ€»ç»“æ€§èƒ½
- **é¢„æœŸ**: æ€»ç»“å†…å®¹å®æ—¶æ˜¾ç¤ºï¼Œæ— æ˜æ˜¾å»¶è¿Ÿ
- **æµ‹è¯•**: è§‚å¯Ÿæ€»ç»“ç”Ÿæˆè¿‡ç¨‹æ˜¯å¦æµç•…

### UIå“åº”æ€§
- **é¢„æœŸ**: æŒ‰é’®ç‚¹å‡»å“åº”æ—¶é—´ < 100ms
- **æµ‹è¯•**: è¿ç»­ç‚¹å‡»æŒ‰é’®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¡é¡¿

### å†…å­˜ä½¿ç”¨
- **é¢„æœŸ**: æ€»ç»“ç”Ÿæˆä¸åº”å¯¼è‡´å†…å­˜æ³„æ¼
- **æµ‹è¯•**: å¤šæ¬¡ç”Ÿæˆæ€»ç»“ï¼Œè§‚å¯Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ

## æˆåŠŸæ ‡å‡†

æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œä¸”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- âœ… è½®æ¬¡è¿›åº¦æ­£ç¡®æ˜¾ç¤ºå’Œæ›´æ–°
- âœ… æŒ‰é’®æ–‡æ¡ˆæ ¹æ®è½®æ¬¡åŠ¨æ€å˜åŒ–
- âœ… æ€»ç»“æµå¼ç”Ÿæˆå¹¶æ­£ç¡®æ˜¾ç¤º
- âœ… "ç»§ç»­è¿½é—®" å’Œ "å…³é—­" æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- âœ… å»ºè®®ç­”æ¡ˆéš¾åº¦æ ‡ç­¾å’Œæ„å›¾è¯´æ˜æ˜¾ç¤ºæ­£ç¡®
- âœ… è¾¹ç•Œæƒ…å†µå¤„ç†åˆç†
- âœ… æ— JavaScripté”™è¯¯æˆ–å´©æºƒ
- âœ… UIå“åº”æµç•…ï¼Œæ— æ€§èƒ½é—®é¢˜

## ä¸‹ä¸€æ­¥ä¼˜åŒ–

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–ï¼š

1. **çŠ¶æ€æŒä¹…åŒ–**: ä½¿ç”¨ MMKV ä¿å­˜ conversationEnded çŠ¶æ€
2. **Markdownæ¸²æŸ“**: ä½¿ç”¨ MarkdownRenderer ç¾åŒ–æ€»ç»“æ˜¾ç¤º
3. **åŠ¨ç”»æ•ˆæœ**: æ·»åŠ æ€»ç»“åŒºåŸŸå±•å¼€/æ”¶èµ·åŠ¨ç”»
4. **åŠ è½½çŠ¶æ€**: ä¼˜åŒ–æ€»ç»“ç”Ÿæˆæ—¶çš„åŠ è½½æç¤º
5. **é”™è¯¯é‡è¯•**: æ·»åŠ æ€»ç»“å¤±è´¥åçš„é‡è¯•æŒ‰é’®
