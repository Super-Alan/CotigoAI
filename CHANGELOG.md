# CotigoAI 更新日志

## [1.0.0] - 2025-01-XX

### 🎯 核心功能

#### 多棱镜视角分析
- ✅ 6个专业角色视角：经济学家、伦理学家、科学家、环保主义者、教育工作者、政策制定者
- ✅ 实时流式生成分析内容
- ✅ 批判性思维框架集成
- ✅ 证据质量指标（🔴高度可信/🟡中等可信/⚪️需要验证）
- ✅ 与角色对话功能
- ✅ 会话持久化

#### 论点深度解构
- ✅ 7维度分析：核心论点、支撑前提、证据支撑、隐含假设、逻辑结构、潜在谬误、综合评估
- ✅ **AI实时流式输出** (v1.2.6) - 流式显示大模型分析过程
  - 实时展示AI思考过程和分析内容
  - 动画脉冲效果指示AI生成状态
  - 单调等宽字体显示确保格式准确
  - 流式响应进度实时更新（0-100%）
- ✅ **解构结果持久化** (v1.2.6) - 自动保存到数据库
  - 分析完成后自动保存输入和结果
  - 解构详情页面查看历史分析
  - 历史记录中快速访问已保存解构
  - 所有者验证确保数据安全
- ✅ **渐进式可视化** - 每个维度逐步展示（200ms间隔）
- ✅ **动画效果** - 淡入 + 向上滑动
- ✅ 支持文本和URL输入
- ✅ 网页内容自动提取

#### 批判性思维增强
- ✅ **苏格拉底式提问** - 为每个视角生成3-5个批判性提问
  - 🎯 挑战假设
  - 📊 要求证据
  - 🔄 探索反例
  - 🧠 检验推理
  - 👁️ 多元视角
- ✅ **认知偏见检测** - 识别10+种常见认知偏见
  - 确认偏见、锚定效应、可得性启发等
  - 具体表现 + 影响评估 + 缓解建议
- ✅ **综合分析优化** - 6维度批判性分析
  - 认知偏见检测
  - 视角冲突深度分析（WHY分歧）
  - 跨视角洞察
  - 集体盲区分析
  - 假设检验
  - 行动建议（包含不确定性）

#### 苏格拉底式对话助手

##### v1.2 智能适配优化（最新）
- ✅ **单一问题原则** - AI每次只提出一个核心问题
  - 降低认知负荷，提供更聚焦的思考体验
  - Prompt强制约束，确保问题质量
- ✅ **自适应提问策略** - 根据用户回答智能调整
  - 简短回答 → 简化问题 + 思考方向
  - 深入回答 → 更具挑战性的问题
  - 困惑状态 → 类比场景 + 分解步骤
  - 语言风格适配（正式/口语）
- ✅ **参考答案分级系统** - 由浅入深三级难度
  - 🌱 入门级：简单直接，适合初学者
  - 🌿 进阶级：中等深度，结合例证
  - 🌳 深度级：批判性反思，挑战假设
  - 视觉标识：颜色编码 + emoji图标
- ✅ **增强提示系统** - 智能学习引导
  - 提问意图分析卡片
  - 单一问题聚焦提示
  - 难度选择建议
- ✅ **对话结束流式总结** - 流式输出到对话窗口
  - 点击"结束并总结"后，总结内容流式显示在左侧对话窗口
  - 对话结束后自动禁用输入框和发送按钮
  - 隐藏右侧智能助手面板
  - 实时流式输出，用户体验更流畅
- ✅ **Markdown渲染优化** (v1.2.1)
  - AI消息使用MarkdownRenderer渲染，支持格式化显示
  - 总结内容正确显示标题、列表、加粗等Markdown格式
- ✅ **智能助手面板控制** (v1.2.1)
  - 添加显示/隐藏切换按钮（对话窗口顶部右侧）
  - 用户可随时控制助手面板的显示状态
  - 对话结束后仍显示按钮，方便查看历史信息
  - 显示"对话已结束"状态指示
- ✅ **状态持久化** (v1.2.2)
  - 使用localStorage保存对话结束状态
  - 保存助手面板显示/隐藏状态
  - 刷新页面后状态正确恢复
  - 防止已结束对话被重新输入
- ✅ **消息复制功能** (v1.2.3)
  - 每条消息添加复制按钮
  - 鼠标悬停时显示灰色复制图标
  - 一键复制消息内容到剪贴板
  - 用户/AI消息均支持复制
- ✅ **助手面板优化** (v1.2.3)
  - 修复对话结束后无法显示助手面板的问题
  - 对话结束后可查看历史参考答案
- ✅ **总结消息持久化** (v1.2.4)
  - 总结内容自动保存到数据库
  - 刷新页面后总结内容保留
  - 总结作为AI消息显示在对话历史中
- ✅ **重复总结智能提示** (v1.2.4)
  - 检测是否已生成总结
  - 已有总结时提供选择：继续追问 or 查看总结
  - 选择"查看总结"自动滚动到总结位置
  - 选择"继续追问"重置对话状态允许继续提问
- ✅ **用户菜单与历史记录** (v1.2.5)
  - 登录后显示用户头像和姓名
  - 点击头像展开下拉菜单
  - 显示最近15条活动历史（对话/解构/视角）
  - 智能时间显示（刚刚/分钟前/小时前/天前）
  - 快速跳转到历史记录继续使用
  - 退出登录功能
  - 统一Header组件应用于所有页面
  - "查看全部历史"链接跳转到完整历史记录页面
  - 历史记录页面支持类型筛选（全部/对话/解构/视角）
  - 显示每种类型的数量统计
  - 完整时间显示（年月日时分）

##### v1.1 交互体验优化
- ✅ **智能助手面板** - 右侧辅助窗口降低学习门槛
  - 💡 参考答案建议（2-3个高质量回答示例）
  - 🎯 提问意图分析（帮助理解AI提问目的）
  - 📊 对话进度追踪（第X/5轮可视化进度条）
- ✅ **5轮对话机制** - 结构化学习体验
  - 自动轮次计数和历史记录
  - 每轮对话后实时生成参考答案
  - 第5轮后提供选择：✅ 结束并总结 或 🔄 继续追问
- ✅ **AI思维总结** - 批判性思维反馈
  - 思维发展轨迹分析
  - 批判性思维亮点识别
  - 温和的改进建议
  - 延伸思考问题推荐
- ✅ **交互优化** - 提升用户体验
  - 点击参考答案直接填入输入框
  - 两栏布局（左侧对话 + 右侧助手）
  - **独立滚动**：左右两侧可分别滚动查看
  - **灵活控制**：用户自主决定对话深度，不限轮次
  - 新一轮对话快速重置功能

### 🚀 技术实现

#### 架构升级
- Next.js 14 (App Router)
- TypeScript 严格模式
- Server-Sent Events (SSE) 流式架构
- AI Router 统一接口（Deepseek V3.1 / Qwen 3 Max）

#### 性能优化
- **论点解构流式输出**
  - 用户感知等待时间降低 70%
  - 分析过程完全透明
  - 7个维度逐步显示
  - 实时进度反馈
- **Token 管理优化**
  - 视角分析：2000 tokens
  - 综合分析：3500 tokens
  - 苏格拉底提问：1000 tokens
- **AI 温度调优**
  - 视角分析：0.7（平衡创造性）
  - 论点解构：0.3（确保JSON一致性）
  - 苏格拉底提问：0.7（鼓励多样性）

#### UI/UX 改进
- 渐进式动画效果（CSS transition 500ms）
- 完成状态徽章
- 实时进度条（蓝紫渐变）
- 旋转加载指示器
- Markdown 渲染优化
- 暗色模式支持

### 🔧 基础设施

#### 数据库
- Prisma ORM
- PostgreSQL
- 模型：User, Conversation, Message, PerspectiveSession, Argument

#### 认证
- NextAuth.js
- Credentials Provider
- Session 管理
- 密码哈希（bcryptjs）

#### AI 集成
- Deepseek V3.1 (默认)
- Qwen 3 Max (备选)
- 流式响应支持
- 错误处理和降级

### 📚 文档

- ✅ README.md - 项目概述
- ✅ QUICKSTART.md - 快速开始指南
- ✅ DATABASE_SETUP_COMPLETE.md - 数据库配置
- ✅ docs/AI_SETUP.md - AI 配置指南
- ✅ docs/DEPLOYMENT.md - 部署文档
- ✅ docs/PROJECT_SUMMARY.md - 项目总结

### 🎨 界面

#### 主页
- 三大核心功能入口
- 功能特性展示
- 响应式设计

#### 视角分析页
- 3种视图模式：逐个查看、对比视角、综合分析
- 苏格拉底式提问按钮
- 与角色对话功能
- 流式生成进度

#### 论点解构页
- 文本/URL 输入切换
- 实时进度条
- 7个维度渐进展示
- 完成状态徽章

### 🐛 已知问题

- [ ] `/api/arguments` 静态渲染警告（使用了 headers）
- [ ] 部分 AI 返回可能需要重试

### 📊 统计

- **总代码量**: ~19,000 行
- **文件数**: 60 个
- **API 路由**: 17 个
- **页面**: 7 个
- **组件**: 1 个（MarkdownRenderer）

---

## 下一步计划

### v1.1.0 (计划中)
- [ ] 逻辑谬误可视化图谱
- [ ] 批判性思维训练模式
- [ ] 分析结果导出（PDF/Markdown）
- [ ] 用户分析历史记录
- [ ] 移动端适配优化

### v1.2.0 (计划中)
- [ ] 团队协作功能
- [ ] 分析结果分享
- [ ] 更多 AI 模型支持
- [ ] 自定义专业角色

---

**🤖 Generated with Claude Code**
https://claude.com/claude-code
